<% if @user.distance([@user.get_user_event_details(@user.event.meetup_event_id)['results'][0]['venue']['lat'], @user.get_user_event_details(@user.event.meetup_event_id)['results'][0]['venue']['lon']], [@user.lat, @user.lon]) < 100 %>

	<!-- This is home for chats -->
	<div></div>

	<%#=  link_to "Join main", '#', class: "btn btn-success btn-xs start-chat", "data-category" => "angularjs", "data-event_id" => 1%>
	<%#=  link_to "Join subchat", '#', class: "btn btn-success btn-xs start-chat", "data-category" => "subchat", "data-event_id" => 1%>
	<%#=  link_to "Join subchat2", '#', class: "btn btn-success btn-xs start-chat", "data-category" => "subchat2", "data-event_id" => 1%>
	<%#=  link_to "Join subchat3", '#', class: "btn btn-success btn-xs start-chat", "data-category" => "subchat3", "data-event_id" => 1%>

	<!-- <%# @chat.users.each do |u| %>
	<li><%#= u.name %></li>
	<%# end %> -->

	<script>
		// on load, make first chat room based on event params
		console.log("starting chat box");
		// grabs data out of the item that was clicked which is setup through html tags
		var category = "<%= @event_category %>";  
		var event_id = <%=@event_id%>;
		
		$.post("/chats", { category: category, event_id: event_id }, function (data) {
		    // data consists of chat_id from chat controller
		    console.log("posted to create/found chat");
		    chatBox.chatWith(data.chat_id);
		}); 

		// delegate to keep track of all items dynamically generated
		$(document).delegate(".start-chat", "click", function (e) {
			e.preventDefault();
			console.log("clicked on chat_link");
	        // e.preventDefault();
	        var category = $(this).data('category');  
	        var event_id = $(this).data('event_id');
	        // menu is finnicky with its labeling of data fields
	        if (event_id == null){
	        	event_id = $(this).data('event-id');
	        }

	        $.post("/chats", { category: category, event_id: event_id }, function (data) {
	            // data consists of chat_id from chat controller
	            console.log("posted to create/found chat");
	            chatBox.chatWith(data.chat_id);
	        }); 
	    });

	    // $("body").css("background-color", "black");
	    heightpixels = $(window).height()-110;
	    var style = $('<style>.chatboxcontent { height: '+heightpixels+'px; }</style>');
		$('html > head').append(style);

	</script>


<% else %>
<div class='container'>
<p class='apologies'>Oops, you're still <%= @user.distance([@user.get_user_event_details(@user.event.meetup_event_id)['results'][0]['venue']['lat'], @user.get_user_event_details(@user.event.meetup_event_id)['results'][0]['venue']['lon']], [@user.lat, @user.lon]) %> miles away from the event! Once you arrive, check back again.</p>
<%= link_to 'Refresh', event_path, class: 'btn btn-primary btn-lg expand' %>
</div>

<% end %>

